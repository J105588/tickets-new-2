<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>チケット予約 | 市川学園座席管理システム</title>
    <link rel="stylesheet" href="../assets/css/styles.css">
    <link rel="stylesheet" href="../assets/css/seats.css">
    <link rel="stylesheet" href="../assets/css/reservation.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Supabase JS -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>

<body>

    <header class="app-header">
        <div class="logo">
            <i class="fas fa-ticket-alt"></i> 市川学園座席管理システム
        </div>
    </header>

    <main class="reservation-container">
        <!-- プログレスバー -->
        <div class="progress-bar">
            <div class="step active" data-step="1">1. 公演選択</div>
            <div class="step" data-step="2">2. 座席選択</div>
            <div class="step" data-step="3">3. 情報入力</div>
            <div class="step" data-step="4">4. 完了</div>
        </div>

        <!-- Step 1: 公演選択 -->
        <section id="step-1" class="step-content active">
            <h2>公演を選択してください</h2>
            <div class="form-group">
                <label for="group-select">部活・団体</label>
                <select id="group-select" class="form-control">
                    <option value="" disabled selected>読み込み中...</option>
                </select>
            </div>
            <div class="form-group">
                <label for="day-select">日程</label>
                <select id="day-select" class="form-control" disabled>
                    <option value="" disabled selected>部活を選択してください</option>
                    <option value="1">1日目</option>
                    <option value="2">2日目</option>
                </select>
            </div>
            <div class="form-group">
                <label for="timeslot-select">時間帯</label>
                <select id="timeslot-select" class="form-control" disabled>
                    <option value="" disabled selected>日程を選択してください</option>
                    <!-- 他の時間帯はJSで動的に制御可能 -->
                </select>
            </div>
            <button id="btn-to-step-2" class="btn btn-primary" disabled>次へ進む</button>
        </section>

        <!-- Step 2: 座席選択 -->
        <section id="step-2" class="step-content">
            <div class="header-with-action">
                <h2>座席を選択してください</h2>
                <button id="btn-back-to-step-1" class="btn btn-secondary btn-sm">戻る</button>
            </div>

            <div class="seat-selection-ui">
                <p class="instruction">ご希望の座席を選択してください。</p>

                <div class="selected-seats-info">
                    選択中の座席: <span id="selected-seats-display">なし</span>
                </div>

                <button id="btn-open-seat-modal" class="btn btn-primary btn-lg btn-block"
                    style="margin: 20px 0; padding: 20px;">
                    <i class="fas fa-map-marked-alt" style="margin-right:8px;"></i> 座席表から選択する
                </button>
            </div>

            <button id="btn-to-step-3" class="btn btn-primary" disabled>次へ進む</button>
        </section>

        <!-- Step 3: 情報入力 -->
        <section id="step-3" class="step-content">
            <div class="header-with-action">
                <h2>予約者情報を入力してください</h2>
                <button id="btn-back-to-step-2" class="btn btn-secondary btn-sm">戻る</button>
            </div>

            <form id="reservation-form">
                <div class="form-group">
                    <label for="res-name">お名前 <span class="required">*</span></label>
                    <input type="text" id="res-name" class="form-control" placeholder="山田 太郎" required>
                </div>
                <div class="form-group">
                    <label for="res-email">メールアドレス <span class="required">*</span></label>
                    <input type="email" id="res-email" class="form-control" placeholder="example@email.com" required>
                    <small>予約完了メールとQRコードが送信されます。</small>
                </div>
                <div class="form-group">
                    <label>お子様の所属年組 <span class="required">*</span></label>
                    <div style="display: flex; gap: 10px;">
                        <select id="res-grade-year" class="form-control">
                            <option value="">年を選択 <span class="required">*</span></option>
                            <!-- 1-6年 + その他 -->
                        </select>
                        <select id="res-grade-class" class="form-control">
                            <option value="">組を選択 <span class="required">*</span></option>
                            <!-- 1-11組 -->
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="res-club-select">お子様の所属部活 <span class="required">*</span></label>
                    <select id="res-club-select" class="form-control">
                        <option value="">選択してください</option>
                        <!-- JSで動的生成 -->
                    </select>
                </div>

                <div class="confirmation-box">
                    <h4>予約内容確認</h4>
                    <p><strong>公演:</strong> <span id="conf-group"></span></p>
                    <p><strong>日時:</strong> <span id="conf-time"></span></p>
                    <p><strong>座席:</strong> <span id="conf-seats"></span></p>
                </div>

                <button type="submit" id="btn-submit" class="btn btn-success btn-lg btn-block">予約を確定する</button>
            </form>
        </section>

        <!-- Step 4: 完了 -->
        <section id="step-4" class="step-content">
            <div class="success-message">
                <i class="fas fa-check-circle"></i>
                <h2>予約が完了しました！</h2>
                <p>ご登録いただいたメールアドレスに確認メールを送信しました。<br>
                    メール内のリンクからQRコードをご確認ください。</p>

                <div class="result-box">
                    <p>予約ID: <strong id="result-booking-id" class="highlight"></strong></p>
                </div>

                <a href="reservation.html" class="btn btn-primary">続けて予約する</a>
            </div>
        </section>

    </main>

    <!-- Seat Selection Modal -->
    <div id="seat-selection-modal" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-header">
                <h3>座席選択</h3>
                <button id="btn-close-modal" class="btn-icon"><i class="fas fa-times"></i></button>
            </div>

            <div class="modal-body">
                <div class="seat-legend">
                    <div class="legend-item">
                        <div class="seat available"></div>空席
                    </div>
                    <div class="legend-item">
                        <div class="seat selected"></div>選択中
                    </div>
                    <div class="legend-item">
                        <div class="seat reserved"></div>不可
                    </div>
                </div>

                <div class="zoom-controls">
                    <button id="btn-zoom-in" class="btn-zoom"><i class="fas fa-plus"></i></button>
                    <button id="btn-zoom-out" class="btn-zoom"><i class="fas fa-minus"></i></button>
                    <button id="btn-zoom-reset" class="btn-zoom"><i class="fas fa-compress"></i></button>
                </div>

                <div id="seat-map-wrapper">
                    <div id="seat-map-container" class="seat-map-container">
                        <div id="loading-spinner" class="spinner"></div>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <div class="modal-selection-info">
                    選択中: <span id="modal-selected-count">0</span>席
                </div>
                <button id="btn-confirm-selection" class="btn btn-success">決定</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script type="module" src="../assets/js/reservation.js"></script>
</body>

</html>